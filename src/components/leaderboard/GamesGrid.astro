---
// src/components/leaderboard/GamesGrid.astro
---

<section class='max-w-5xl px-4 py-16 mx-auto'>
	<h2 class='mb-8 text-3xl font-bold text-center'>Bier Olympics Spellen</h2>
	<div id='games' class='grid gap-8 text-white sm:grid-cols-2 md:grid-cols-3'></div>

	<script is:inline type='module'>
		const container = document.getElementById('games')
		const CACHE_KEY = 'games-cache-v1'
		const CACHE_TTL_MS = 60 * 1000

		const cached = JSON.parse(localStorage.getItem(CACHE_KEY) || 'null')
		const isFresh = cached && Date.now() - cached.timestamp < CACHE_TTL_MS

		const games = isFresh
			? cached.data
			: await fetch(
					'https://raw.githubusercontent.com/melchiorhering/melchiorhering.github.io/main/src/data/games.json'
				)
					.then((res) => res.json())
					.then((data) => {
						localStorage.setItem(CACHE_KEY, JSON.stringify({ data, timestamp: Date.now() }))
						return data
					})

		const html = games
			.map(
				(game) => `
			<div class="p-4 transition-all bg-gray-800 border border-gray-700 shadow rounded-xl hover:shadow-xl">
				<img src="${game.image}" alt="${game.name}" class="object-contain w-full h-32 mb-4 rounded" />
				<h3 class="mb-2 text-xl font-semibold">${game.name}</h3>
				<p class="text-sm text-gray-100">${game.description}</p>
			</div>
		`
			)
			.join('')

		container.innerHTML = html
	</script>
</section>

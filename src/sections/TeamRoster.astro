---
// src/leaderboard/components/TeamRoster.astro
---

<section id='teams' class='max-w-5xl px-4 pt-6 mx-auto'>
	<h2 class='mb-8 text-4xl font-bold text-center drop-shadow-lg'>Team Rooster</h2>
	<div id='team-roster' class='grid gap-8 text-white md:grid-cols-2'></div>

	<script is:inline type='module'>
		const container = document.getElementById('team-roster')
		const CACHE_KEY = 'teams-cache-v1'
		const CACHE_TTL_MS = parseInt(localStorage.getItem('fetch-ttl') || '60000')

		const cached = JSON.parse(localStorage.getItem(CACHE_KEY) || 'null')
		const isFresh = cached && Date.now() - cached.timestamp < CACHE_TTL_MS
		const fetchEnabled = localStorage.getItem('enable-fetch') === 'true'

		const teams =
			fetchEnabled && !isFresh
				? await fetch(
						'https://script.google.com/macros/s/AKfycbx5dfoJhQTjR2QdsraYKbt2nkAqsy9702douB08uyliGH8YaVHCOWL1q7eKLXkxf8efkA/exec'
					)
						.then((res) => res.json())
						.then((data) => {
							localStorage.setItem(CACHE_KEY, JSON.stringify({ data, timestamp: Date.now() }))
							return data
						})
				: cached?.data || []

		const colors = [
			'from-pink-500 to-purple-600',
			'from-cyan-500 to-blue-600',
			'from-yellow-500 to-orange-500',
			'from-green-400 to-emerald-500'
		]
		const emoji = [
			'🏆',
			'🎯',
			'🍻',
			'🔥',
			'💪',
			'🥳',
			'🚀',
			'🎮',
			'🧠',
			'🎉',
			'👑',
			'🦤',
			'🌈',
			'🐉',
			'🐍',
			'🐯',
			'🦖',
			'👽',
			'🤖',
			'🐙',
			'🧙',
			'🧛',
			'🧜',
			'🤸',
			'🤹',
			'🧜',
			'💀',
			'🐵',
			'🐸',
			'🐯',
			'🐼',
			'🐨',
			'🐧',
			'🐺',
			'🐔',
			'🦆',
			'🐢',
			'🐬',
			'🐳',
			'🦓',
			'🍕',
			'🍔',
			'🍩',
			'🍭',
			'🍉',
			'🍇',
			'🥥',
			'🥑',
			'🥐',
			'🍿'
		]

		const html = teams
			.map(
				(team, i) => `
			<div class="p-6 text-center transform transition-all bg-gradient-to-br ${colors[i % colors.length]} rounded-xl shadow-xl hover:scale-105 hover:shadow-2xl">
				<h3 class="mb-3 text-2xl font-extrabold text-white drop-shadow-sm">
					${emoji[i % emoji.length]} ${team.team}
				</h3>
				<div class="grid grid-cols-2 text-lg font-semibold text-white gap-y-2 place-items-center">
					${team.members.map((member) => `<div>${member}</div>`).join('')}
				</div>
			</div>
		`
			)
			.join('')

		container.innerHTML = html
	</script>
</section>
